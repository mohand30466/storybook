const execTask = require('./util/exec-task')

exports.props = {}
exports.inject = t => {
  const prop = t.props.done
  const props = {
    restart: (t, val, key, stamp) => {
      const changed = prop(t, val, key, stamp)
      if (
        (changed && val !== null) ||
        (val && val.stamp && val.val !== null)
      ) { execTask(t) }
      return changed
    }
  }
  t.set({ props }, false)
}
