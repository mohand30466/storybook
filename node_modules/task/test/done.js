const test = require('tape')
const ploy = require('../')

test('use done property', t => {
  t.plan(1)

  const done = ploy.get(['tasks', 'one', 'done'], {})

  done.on(val => {
    if (val !== null) {
      t.pass(`done fires once with stamp: ${val}`)
      ploy.tasks.set({}, false, true)
    }
  })

  ploy.tasks.set({
    one: {
      val: () => new Promise(resolve => resolve({ done: true }))
    }
  })
})
